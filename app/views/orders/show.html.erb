<%= render 'navtab' %>
<div class="card">
  <ul class="list-group list-group-flush">
    <li class="list-group-item"><strong>Num√©ro de commande:</strong> <%= @order.id %></li>
    <li class="list-group-item"><strong>Client:</strong> <%= @order.user.first_name + " " + @order.user.last_name  %></li>
    <li class="list-group-item"><strong>Prix total:</strong> <%= number_to_currency(@totalOrder, unit:"CHF", format: "%n %u", delimiter:"'") %></li>
    <li class="list-group-item"><strong>R√©duction:</strong> <%= number_to_currency(@order.discount, unit:"CHF", format: "%n %u", delimiter:"'") %></li>
    <li class="list-group-item"><strong>Livraison:</strong> <%= @order.shipping %></li>
    <li class="list-group-item"><strong>Suivi:</strong> <%= @order.tracking %></li>
    <li class="list-group-item"><strong>Commentaire Boutique:</strong> <%= @order.comment_shop %></li>
    <li class="list-group-item"><strong>Adresse:</strong> <%= @order.user.address %></li>
    <li class="list-group-item"><strong>Code postal:</strong> <%= @order.user.city.to_s + @order.user.postal_code.to_s %></li>
    <li class="list-group-item"><strong>Type de paiement:</strong> <%= @order.payment %></li>
    <% if @order.shipping == 'poste' %>
      <li class="list-group-item"><strong>Frais de livraison:</strong> 7.00 CHF</li>
    <% end %>
    <li class="list-group-item"><strong>Prix total apr√®s r√©duction:</strong> <%=  number_to_currency(@totalOrderDiscount, unit:"CHF", format: "%n %u", delimiter:"'") %></li>
    <li class="list-group-item"><strong>Etat paiement:</strong> <%= @order.is_paid %></li>
    <li class="list-group-item"><strong>Etat commande:</strong> <%= @order.is_ready %></li>
    <li class="list-group-item">
      <div class="status-paiement">
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_paid, :value => 'attente' %>
          <% if @order.is_paid == 'attente' %>
            <%= form.label "paiement en attente", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "paiement en attente", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_paid, :value => 'validation' %>
          <% if @order.is_paid == 'validation' %>
            <%= form.label "paiement en validation", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "paiement en validation", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_paid, :value => 'pay√©e' %>
          <% if @order.is_paid == 'pay√©e' %>
            <%= form.label "pay√©e", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "pay√©e", class:"btn btn-primary" %>
          <% end %>
        <% end %>
      </div>
      <div class="status-commande">
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'cr√©√©e' %>
          <% if @order.is_ready == 'cr√©√©e' %>
            <%= form.label "commande cr√©√©e", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande cr√©√©e", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'pr√™te' %>
          <% if @order.is_ready == 'pr√™te' %>
            <%= form.label "commande pr√™te", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande pr√™te", data: { confirm: 'Le client sera notifi√© √™tes vous certain ?' }, class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'envoy√©e' %>
          <% if @order.is_ready == 'envoy√©e' %>
            <%= form.label "commande envoy√©e", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande envoy√©e", data: { confirm: 'Le client sera notifi√© √™tes vous certain ?' }, class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'termin√©e' %>
          <% if @order.is_ready == 'termin√©e' %>
            <%= form.label "commande termin√©e", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande termin√©e", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'annul√©e' %>
          <% if @order.is_ready == 'annul√©e' %>
            <%= form.label "commande annul√©e", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande annul√©e", data: { confirm: 'Les produits seront remis en stock √™tes vous certain ?' }, class:"btn btn-primary" %>
          <% end %>
        <% end %>
      </div>
    </ul>
    <h3>D√©tail de la commande</h3>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Produit</th>
          <th>Quantit√©</th>
          <th>Prix Unitaire</th>
          <th>Prix Total</th>
          <th colspan="2"></th>
        </tr>
      </thead>
      <% @order.buys.each do |buy| %>
        <tr>
          <td><%= link_to buy.product.name, boutique_produit_path + "/?id=" + buy.product.id.to_s %></td>
          <td><%= buy.quantity %></td>
          <td><%= number_to_currency(buy.price, unit:"CHF", format: "%n %u", delimiter:"'") %></td>
          <td><%= number_to_currency(buy.price * buy.quantity, unit:"CHF", format: "%n %u", delimiter:"'")  %></td>
          <td class="text-center">
            <div class="status-commande">
              <%= form_with(model: buy, :as => :put, :url => buy_path(:id => buy.id)) do |form| %>
                <%= form.hidden_field :quantity, value: buy.quantity - 1 %>
                <%= form.submit "-", class:"btn btn-danger"%>
              <% end %>
              <%= form_with(model: buy, :as => :put, :url => buy_path(:id => buy.id)) do |form| %>
                <%= form.hidden_field :quantity, value: buy.quantity + 1 %>
                <%= form.submit "+", class:"btn btn-success"%>
              <% end %>
            </div>
          </td>
          <td>
            <p>
              <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target=<%="#collapseWidthExample"+buy.id.to_s %> aria-expanded="false" aria-controls="collapseWidthExample">
                Transf√©rer
              </button>
            </p>
            <div class="collapse collapse-horizontal" id=<%="collapseWidthExample"+buy.id.to_s %>>
              <div class="" style="width: 200px;">
                <%= form_with(model: buy, :as => :put, :url => buy_path(:id => buy.id)) do |form| %>
                  ID: <%= form.text_field :order_id, size:4 %>
                  <%= form.submit "OK", class:"btn btn-success"%>
                <% end %>
              </div>
            </div>
          </td>
        </tr>
      <% end %>
    </table>
    <div class="card-body">
      <%= link_to 'Ajouter produit √† la commande ‚ûï', new_buy_path + "?order=" + @order.id.to_s, class:"btn btn-success" %>
      <%= link_to 'Modifier la commande ‚úèÔ∏è', edit_order_path(@order), class:"btn btn-dark" %>
      <%= link_to 'Retour ‚¨ÖÔ∏è', orders_path, class:"btn btn-dark" %>
      <%= link_to 'Imprimer üñ®Ô∏è', orders_print_path + '?id=' + @order.id.to_s, target: :_blank, class:"btn btn-dark" %>
    </div>
  </div>
