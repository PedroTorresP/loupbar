<%= render 'navtab' %>
<div class="card">
  <ul class="list-group list-group-flush">
    <li class="list-group-item"><strong>Numéro de commande:</strong> <%= @order.id %></li>
    <li class="list-group-item"><strong>Client:</strong> <%= @order.user.first_name + " " + @order.user.last_name  %></li>
    <li class="list-group-item"><strong>Prix total:</strong> <%= @totalOrder %></li>
    <li class="list-group-item"><strong>Réduction:</strong> <%= @order.discount %></li>
    <li class="list-group-item"><strong>Livraison:</strong> <%= @order.shipping %></li>
    <li class="list-group-item"><strong>Suivi:</strong> <%= @order.tracking %></li>
    <li class="list-group-item"><strong>Type de paiement:</strong> <%= @order.payment %></li>
    <li class="list-group-item"><strong>Prix total après réduction:</strong> <%=  @totalOrderDiscount %></li>
    <li class="list-group-item"><strong>Etat paiement:</strong> <%= @order.is_paid %></li>
    <li class="list-group-item"><strong>Etat commande:</strong> <%= @order.is_ready %></li>
    <li class="list-group-item">
      <div class="status-paiement">
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_paid, :value => 'attente' %>
          <% if @order.is_paid == 'attente' %>
            <%= form.submit "paiement en attente", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "paiement en attente", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_paid, :value => 'validation' %>
          <% if @order.is_paid == 'validation' %>
            <%= form.submit "paiement en validation", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "paiement en validation", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_paid, :value => 'payée' %>
          <% if @order.is_paid == 'payée' %>
            <%= form.submit "payée", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "payée", class:"btn btn-primary" %>
          <% end %>
        <% end %>
      </div>
      <div class="status-commande">
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'crée' %>
          <% if @order.is_ready == 'crée' %>
            <%= form.submit "commande crée", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande crée", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'prête' %>
          <% if @order.is_ready == 'prête' %>
            <%= form.submit "commande prête", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande prête", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'envoyée' %>
          <% if @order.is_ready == 'envoyée' %>
            <%= form.submit "commande envoyée", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande envoyée", class:"btn btn-primary" %>
          <% end %>
        <% end %>
        <%= form_with(model: @order, :as => :put, :url => order_path) do |form| %>
          <%= form.hidden_field :is_ready, :value => 'terminée' %>
          <% if @order.is_ready == 'terminée' %>
            <%= form.submit "commande terminée", class:"btn btn-warning" %>
          <% else %>
            <%= form.submit "commande terminée", class:"btn btn-primary" %>
          <% end %>
        <% end %>
      </div>
    </ul>
    <h3>Détail de la commande</h3>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Produit</th>
          <th>Quantité</th>
          <th>Prix Unitaire</th>
          <th>Prix Total</th>
          <th colspan="2"></th>
        </tr>
      </thead>
      <% @order.buys.each do |buy| %>
        <tr>
          <td><%= buy.product.name %></td>
          <td><%= buy.quantity %></td>
          <td><%= buy.product.price %></td>
          <td><%= buy.product.price * buy.quantity %></td>
          <td><%= link_to 'Modifier', edit_order_path(@order) %></td>
          <td><%= link_to 'Supprimer', @order, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
      <div class="card-body">
        <%= link_to 'Ajouter produit à la commande ➕', new_buy_path + "?order=" + @order.id.to_s, class:"btn btn-success" %>
        <%= link_to 'Modifier la commande ✏️', edit_order_path(@order), class:"btn btn-dark" %>
        <%= link_to 'Retour ⬅️', orders_path, class:"btn btn-dark" %>
      </div>
    </div>
